import{b as m}from"./chunk-F224JCPE.js";import{c as v,d as x}from"./chunk-W7DUVHSF.js";import{f as y}from"./chunk-FF2NHPLS.js";import{b as l}from"./chunk-65CEQG3Z.js";var c,d=null;async function b(){return d||(d=new Promise((t,s)=>{let n,e=null,o={preserveDrawingBuffer:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};import("./chunk-BYDGRK4R.js").then(({ThinEngine:i})=>{let p=l.Instances.length;try{n=new OffscreenCanvas(100,100),e=new i(n,!1,o)}catch{p<l.Instances.length&&l.Instances.pop()?.dispose(),n=document.createElement("canvas"),e=new i(n,!1,o)}l.Instances.pop(),l.OnEnginesDisposedObservable.add(r=>{e&&r!==e&&!e.isDisposed&&l.Instances.length===0&&I()}),e.getCaps().parallelShaderCompile=void 0;let f=new v(e);import("./chunk-INY37KM4.js").then(({passPixelShader:r})=>{if(!e){s("Engine is not defined");return}let a=new x({engine:e,name:r.name,fragmentShader:r.shader,samplerNames:["textureSampler"]});c={canvas:n,engine:e,renderer:f,wrapper:a},t(c)})}).catch(s)})),await d}async function A(t,s,n,e,o="image/png",i,p){let f=await n.readPixels(0,0,t,s),r=new Uint8Array(f.buffer);w(t,s,r,e,o,i,!0,void 0,p)}async function E(t,s,n,e="image/png",o,i=!1,p=!1,f){return await new Promise(r=>{w(t,s,n,a=>r(a),e,o,i,p,f)})}function w(t,s,n,e,o="image/png",i,p=!1,f=!1,r){b().then(a=>{if(a.engine.setSize(t,s,!0),n instanceof Float32Array){let g=new Uint8Array(n.length),u=n.length;for(;u--;){let D=n[u];g[u]=Math.round(y(D)*255)}n=g}let h=a.engine.createRawTexture(n,t,s,5,!1,!p,1);a.renderer.setViewport(),a.renderer.applyEffectWrapper(a.wrapper),a.wrapper.effect._bindTexture("textureSampler",h),a.renderer.draw(),f?m.ToBlob(a.canvas,g=>{let u=new FileReader;u.onload=D=>{let S=D.target.result;e&&e(S)},u.readAsArrayBuffer(g)},o,r):m.EncodeScreenshotCanvasData(a.canvas,e,o,i,r),h.dispose()})}function I(){c?(c.wrapper.dispose(),c.renderer.dispose(),c.engine.dispose()):d?.then(t=>{t.wrapper.dispose(),t.renderer.dispose(),t.engine.dispose()}),d=null,c=null}var T={DumpData:w,DumpDataAsync:E,DumpFramebuffer:A,Dispose:I},C=()=>{m.DumpData=w,m.DumpDataAsync=E,m.DumpFramebuffer=A};C();export{A as a,E as b,w as c,I as d,T as e};
